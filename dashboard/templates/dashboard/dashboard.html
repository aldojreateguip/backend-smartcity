{% extends 'core-dashboard/base.html' %}
{% load static %}
{% block title %} Dashboard {% endblock title %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/jquery.dataTables.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/dashboard.css' %}">
<main class="sm:pl-52 pt-24">
    <div id="mapa" class="w-full min-h-[20rem] sm:min-h-[37.5rem]">
    
    </div>
</main>
<div class="sm:ml-52 ml-0 mt-4 mx-auto bg-white/50">
    <table id="mytable" class="display">
        <thead>
            <tr>
                <th>Columna 1</th>
                <th>Columna 2</th>
                <th>Columna 3</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

{% endblock %}
{% block javascript %}
<script src="{% static 'js/externo/jquery.dataTables.min.js' %}"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    let marker = null;
    let myMap = L.map('mapa').setView([-3.746241, -73.2478283], 13)

    const urlOpenLayers = 'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png'
    L.tileLayer(urlOpenLayers, {
         maxZoom: 19,
    }).addTo(myMap)
    
    function actualizarUbicacionMarcador() {
        $.ajax({
            url: '/getmarker/',
            method: 'GET',
            dataType: 'json',
            success: function (response) {
                var latitude = response.latitud;
                var longitude = response.longitud;
                if (marker) {
                    myMap.removeLayer(marker)
                }
                console.log(latitude, longitude)
                marker = L.marker([latitude, longitude]).addTo(myMap)
                setTimeout(actualizarUbicacionMarcador, 3000)
            },
            error: function (error) {
                console.log('Error al obtener la ubicación del marcador:', error);
            }
        });
    }

    // Ejecutar la función inicialmente
    actualizarUbicacionMarcador();
</script>
{% endblock %}